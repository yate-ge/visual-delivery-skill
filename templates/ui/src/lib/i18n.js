const locales = {
  en: {
    appTitle: 'Visual Delivery',
    settings: 'Settings',
    loadingDeliveries: 'Loading deliveries...',
    noDeliveries: 'No deliveries yet.',
    statusPending: 'pending_feedback',
    statusNormal: 'normal',
    justNow: 'just now',
    minAgo: '{n} min ago',
    hoursAgo: '{n}h ago',
    daysAgo: '{n}d ago',
    back: '\u2190 Back',
    statusLabel: 'Status',
    createdLabel: 'Created',
    projectLabel: 'Project',
    taskLabel: 'Task',
    generatedLabel: 'Generated',
    deliveryNotFound: 'Delivery not found',
    feedbackStateTitle: 'Feedback Processing State',
    pendingFeedbackEntries: 'Pending feedback entries',
    resolvedFeedbackEntries: 'Resolved feedback entries',
    feedbackSidebar: 'Feedback Sidebar',
    draftCount: '{n} draft',
    addDirectFeedback: 'Global supplementary feedback',
    typeFeedbackPlaceholder: 'Type supplementary feedback for the agent',
    addToDrafts: 'Add to Drafts',
    draftItems: 'Draft items',
    noDraftFeedback: 'No draft feedback yet.',
    remove: 'Remove',
    submitting: 'Submitting...',
    confirmSubmit: 'Confirm Submit',
    pendingFeedbackForAgent: 'Pending feedback for agent',
    noPendingFeedback: 'No pending feedback.',
    revoke: 'Revoke',
    revokeConfirm: 'Revoke this feedback?',
    feedbackRevoked: 'Feedback revoked.',
    annotationLabel: 'Annotation',
    interactiveLabel: 'Action',
    directLabel: 'Direct',
    quotePrefix: 'On',
    actionPrefix: 'Action',
    fieldsLabel: 'Fields',
    pendingBadge: 'Pending',
    handledBadge: 'Handled',
    selectedText: 'Selected text',
    addFeedbackForSelection: 'Add feedback for this selection',
    addToSidebar: 'Add to sidebar',
    close: 'Close',
    table: 'Table',
    list: 'List',
    filterRows: 'Filter rows',
    asc: 'Asc',
    desc: 'Desc',
    addViewStateFeedback: 'Add this view state to feedback',
    addFormResponseFeedback: 'Add form response to feedback',
    noReviewItems: 'No review items provided.',
    reviewItem: 'Review item',
    issueLabel: 'Issue',
    suggestionLabel: 'Suggestion',
    decisionLabel: 'Decision',
    selectDecision: 'Select decision',
    notesLabel: 'Notes',
    notesPlaceholder: 'Add specific requirement or rationale',
    addReviewDecisionFeedback: 'Add row decision to feedback',
    noUiSpecComponents: 'No UI specification components were provided.',
    executionTimelineTitle: 'Execution Timeline',
    noExecutionEvents: 'No execution events yet.',
    stageQueued: 'queued',
    stageInProgress: 'in_progress',
    stageCompleted: 'completed',
    stageFailed: 'failed',
    stageInfo: 'info',
    settingsTitle: 'Settings',
    platformBranding: 'Platform Branding',
    loadingSettings: 'Loading settings...',
    language: 'Language',
    languageZh: 'Chinese',
    languageEn: 'English',
    platformName: 'Platform Name',
    logoUrl: 'Logo URL',
    slogan: 'Slogan',
    visualStyle: 'Visual Style',
    saving: 'Saving...',
    savePlatformSettings: 'Save Platform Settings',
    designFiles: 'Design Files',
    currentTokenValues: 'Current Token Values',
    loadingDesignTokens: 'Loading design tokens...',
    errorLoadingSettings: 'Error loading settings: {message}',
    saveFailed: 'Save failed: {message}',
    settingsSaved: 'Platform settings saved.',
    loading: 'Loading...',
    errorPrefix: 'Error',
    notAvailable: 'n/a',
  },
  zh: {
    appTitle: '视觉交付',
    settings: '设置',
    loadingDeliveries: '正在加载交付页面...',
    noDeliveries: '暂无交付内容。',
    statusPending: '待处理反馈',
    statusNormal: '正常',
    justNow: '刚刚',
    minAgo: '{n} 分钟前',
    hoursAgo: '{n} 小时前',
    daysAgo: '{n} 天前',
    back: '\u2190 返回',
    statusLabel: '状态',
    createdLabel: '创建于',
    projectLabel: '项目',
    taskLabel: '任务',
    generatedLabel: '生成时间',
    deliveryNotFound: '未找到交付内容',
    feedbackStateTitle: '反馈处理状态',
    pendingFeedbackEntries: '待处理反馈条目',
    resolvedFeedbackEntries: '已处理反馈条目',
    feedbackSidebar: '反馈侧边栏',
    draftCount: '{n} 条草稿',
    addDirectFeedback: '全局补充反馈',
    typeFeedbackPlaceholder: '输入给 Agent 的补充反馈',
    addToDrafts: '加入草稿',
    draftItems: '草稿条目',
    noDraftFeedback: '暂无反馈草稿。',
    remove: '移除',
    submitting: '提交中...',
    confirmSubmit: '确认提交',
    pendingFeedbackForAgent: '待 Agent 处理的反馈',
    noPendingFeedback: '暂无待处理反馈。',
    revoke: '撤回',
    revokeConfirm: '确定撤回此反馈？',
    feedbackRevoked: '反馈已撤回。',
    annotationLabel: '标注',
    interactiveLabel: '交互',
    directLabel: '直接反馈',
    quotePrefix: '关于',
    actionPrefix: '操作',
    fieldsLabel: '字段',
    pendingBadge: '待处理',
    handledBadge: '已处理',
    selectedText: '已选中文本',
    addFeedbackForSelection: '为这段选中文本添加反馈',
    addToSidebar: '加入侧边栏',
    close: '关闭',
    table: '表格',
    list: '列表',
    filterRows: '筛选行',
    asc: '升序',
    desc: '降序',
    addViewStateFeedback: '将当前视图状态加入反馈',
    addFormResponseFeedback: '将表单回答加入反馈',
    noReviewItems: '未提供可审查条目。',
    reviewItem: '审查项',
    issueLabel: '问题',
    suggestionLabel: '建议',
    decisionLabel: '决策',
    selectDecision: '选择决策',
    notesLabel: '备注',
    notesPlaceholder: '填写具体需求或原因',
    addReviewDecisionFeedback: '将该行决策加入反馈',
    noUiSpecComponents: '未提供可渲染的 UI 组件。',
    executionTimelineTitle: '执行时间线',
    noExecutionEvents: '暂无执行事件。',
    stageQueued: '已排队',
    stageInProgress: '处理中',
    stageCompleted: '已完成',
    stageFailed: '失败',
    stageInfo: '信息',
    settingsTitle: '设置',
    platformBranding: '平台品牌信息',
    loadingSettings: '正在加载设置...',
    language: '界面语言',
    languageZh: '中文',
    languageEn: '英文',
    platformName: '平台名称',
    logoUrl: 'Logo 地址',
    slogan: '标语',
    visualStyle: '视觉风格',
    saving: '保存中...',
    savePlatformSettings: '保存平台设置',
    designFiles: '设计文件',
    currentTokenValues: '当前 Token 值',
    loadingDesignTokens: '正在加载设计 Token...',
    errorLoadingSettings: '加载设置失败：{message}',
    saveFailed: '保存失败：{message}',
    settingsSaved: '平台设置已保存。',
    loading: '加载中...',
    errorPrefix: '错误',
    notAvailable: '无',
  },
};

function normalizeLang(lang) {
  if (!lang || typeof lang !== 'string') return 'en';
  return lang.toLowerCase().startsWith('zh') ? 'zh' : 'en';
}

function detectPreferredLang() {
  if (typeof document !== 'undefined') {
    const docLang = document.documentElement?.lang;
    if (docLang) return normalizeLang(docLang);
  }
  if (typeof navigator !== 'undefined' && navigator.language) {
    return normalizeLang(navigator.language);
  }
  return 'en';
}

let currentLang = detectPreferredLang();

export function setLang(lang) {
  currentLang = normalizeLang(lang);
}

export function initLang(lang) {
  setLang(lang || detectPreferredLang());
  return currentLang;
}

export function t(key, params = {}) {
  const str = (locales[currentLang] && locales[currentLang][key]) || locales.en[key] || key;
  return str.replace(/\{(\w+)\}/g, (_, k) => (params[k] !== undefined ? params[k] : `{${k}}`));
}

export function getLang() {
  return currentLang;
}

export function isZh() {
  return currentLang === 'zh';
}
